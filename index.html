<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Reviews ‚Äî SRM's Unfiltered Guide</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Familjen+Grotesk:wght@400;500;600;700;800&family=Permanent+Marker&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  :root {
    --bg:#0a0a0f; --surface:#13131a; --neon-yellow:#f5e642; --neon-pink:#ff3d8b;
    --neon-cyan:#00e5ff; --neon-orange:#ff6b2b; --text:#f0eee8; --muted:#6b6b80;
    --border:rgba(245,230,66,0.15);
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{background:var(--bg);color:var(--text);font-family:'Familjen Grotesk',sans-serif;overflow-x:hidden;cursor:none}
  body::before{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:1000;opacity:.4}

  /* CURSOR */
  .cursor{width:12px;height:12px;background:var(--neon-yellow);border-radius:50%;position:fixed;top:0;left:0;pointer-events:none;z-index:9999;mix-blend-mode:difference}
  .cursor-ring{width:36px;height:36px;border:1.5px solid var(--neon-yellow);border-radius:50%;position:fixed;top:0;left:0;pointer-events:none;z-index:9998;transition:width .2s,height .2s;mix-blend-mode:difference}

  /* NAV */
  nav{display:flex;align-items:center;justify-content:space-between;padding:1.25rem 3rem;border-bottom:1px solid var(--border);position:sticky;top:0;z-index:500;background:rgba(10,10,15,.9);backdrop-filter:blur(20px)}
  .logo{font-family:'Permanent Marker',cursive;font-size:1.4rem;color:var(--neon-yellow);text-shadow:0 0 20px rgba(245,230,66,.4)}
  .logo span{color:var(--neon-pink)}
  .nav-links{display:flex;gap:2rem;list-style:none}
  .nav-links a{color:var(--muted);text-decoration:none;font-weight:600;font-size:.8rem;letter-spacing:.05em;text-transform:uppercase;transition:color .2s;cursor:none}
  .nav-links a:hover,.nav-links a.active{color:var(--neon-yellow)}
  .nav-right{display:flex;gap:.75rem;align-items:center}
  #userInfo{font-size:.75rem;color:var(--muted);font-family:'Space Mono',monospace}
  .nav-btn{background:var(--neon-yellow);color:#0a0a0f;border:none;padding:.55rem 1.25rem;font-family:'Familjen Grotesk',sans-serif;font-weight:800;font-size:.8rem;text-transform:uppercase;letter-spacing:.05em;cursor:none;clip-path:polygon(0 0,calc(100% - 8px) 0,100% 8px,100% 100%,8px 100%,0 calc(100% - 8px));transition:all .2s}
  .nav-btn:hover{background:var(--neon-pink);color:#fff}
  .nav-btn.ghost{background:transparent;color:var(--text);border:1px solid var(--border);clip-path:none}
  .nav-btn.ghost:hover{border-color:var(--neon-cyan);color:var(--neon-cyan);background:transparent}
  .nav-btn.danger{background:transparent;color:var(--neon-pink);border:1px solid rgba(255,61,139,.3);clip-path:none}
  .nav-btn.danger:hover{background:rgba(255,61,139,.1)}

  /* HERO */
  .hero{min-height:90vh;display:grid;grid-template-columns:1fr 1fr;position:relative;overflow:hidden}
  .hero-bg-grid{position:absolute;inset:0;background-image:linear-gradient(rgba(245,230,66,.04) 1px,transparent 1px),linear-gradient(90deg,rgba(245,230,66,.04) 1px,transparent 1px);background-size:60px 60px}
  .hero-left{padding:5rem 3rem 5rem 4rem;display:flex;flex-direction:column;justify-content:center;position:relative;z-index:2}
  .badge{display:inline-flex;align-items:center;gap:.5rem;background:rgba(245,230,66,.1);border:1px solid rgba(245,230,66,.3);color:var(--neon-yellow);padding:.35rem .9rem;font-size:.72rem;font-weight:700;letter-spacing:.1em;text-transform:uppercase;width:fit-content;margin-bottom:1.75rem;animation:fadeUp .6s ease both}
  .badge::before{content:'';width:6px;height:6px;background:var(--neon-yellow);border-radius:50%;animation:blink 1.2s infinite}
  @keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
  h1{font-size:clamp(2.8rem,4.5vw,4.5rem);font-weight:800;line-height:1.0;letter-spacing:-.03em;animation:fadeUp .7s .1s ease both}
  h1 .l2{color:var(--neon-pink)}
  h1 .l3{color:transparent;-webkit-text-stroke:2px var(--neon-cyan)}
  .hero-desc{margin-top:1.5rem;color:var(--muted);font-size:1rem;line-height:1.7;max-width:420px;animation:fadeUp .7s .2s ease both}
  .hero-desc strong{color:var(--text)}
  .hero-actions{margin-top:2rem;display:flex;gap:1rem;flex-wrap:wrap;animation:fadeUp .7s .3s ease both}
  .btn-pri{background:var(--neon-yellow);color:#0a0a0f;border:none;padding:.85rem 1.8rem;font-family:'Familjen Grotesk',sans-serif;font-weight:800;font-size:.95rem;cursor:none;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px));transition:all .2s}
  .btn-pri:hover{background:var(--neon-pink);color:#fff;transform:translateY(-2px)}
  .btn-ghost-hero{background:transparent;color:var(--text);border:1px solid var(--border);padding:.85rem 1.8rem;font-family:'Familjen Grotesk',sans-serif;font-weight:700;font-size:.95rem;cursor:none;transition:all .2s}
  .btn-ghost-hero:hover{border-color:var(--neon-cyan);color:var(--neon-cyan)}
  .hero-stats{margin-top:3rem;display:flex;gap:2.5rem;animation:fadeUp .7s .4s ease both}
  .stat-num{font-family:'Space Mono',monospace;font-size:1.6rem;font-weight:700;color:var(--neon-yellow)}
  .stat-label{font-size:.7rem;color:var(--muted);text-transform:uppercase;letter-spacing:.08em;margin-top:.2rem}
  .hero-right{position:relative;z-index:2;display:flex;align-items:center;justify-content:center;padding:3rem}
  .card-stack{position:relative;width:320px;height:460px}
  .review-card{position:absolute;background:var(--surface);border:1px solid var(--border);padding:1.25rem;width:290px;box-shadow:0 20px 60px rgba(0,0,0,.5)}
  .review-card:nth-child(1){top:0;left:10px;border-top:3px solid var(--neon-yellow);animation:float1 4s ease-in-out infinite;transform:rotate(-2deg)}
  .review-card:nth-child(2){top:80px;left:50px;border-top:3px solid var(--neon-pink);animation:float2 5s ease-in-out infinite;transform:rotate(1.5deg)}
  .review-card:nth-child(3){top:160px;left:5px;border-top:3px solid var(--neon-cyan);animation:float3 4.5s ease-in-out infinite;transform:rotate(-1deg)}
  @keyframes float1{0%,100%{transform:rotate(-2deg) translateY(0)}50%{transform:rotate(-2deg) translateY(-8px)}}
  @keyframes float2{0%,100%{transform:rotate(1.5deg) translateY(0)}50%{transform:rotate(1.5deg) translateY(-12px)}}
  @keyframes float3{0%,100%{transform:rotate(-1deg) translateY(0)}50%{transform:rotate(-1deg) translateY(-6px)}}
  .card-tag{font-size:.62rem;font-weight:700;letter-spacing:.12em;text-transform:uppercase;padding:.2rem .5rem;width:fit-content;margin-bottom:.6rem}
  .tag-food{background:rgba(255,107,43,.2);color:var(--neon-orange)}
  .tag-spot{background:rgba(0,229,255,.15);color:var(--neon-cyan)}
  .tag-flat{background:rgba(255,61,139,.15);color:var(--neon-pink)}
  .tag-travel{background:rgba(245,230,66,.15);color:var(--neon-yellow)}
  .card-title{font-weight:700;font-size:.95rem;margin-bottom:.4rem}
  .card-body{font-size:.78rem;color:var(--muted);line-height:1.6}
  .card-footer{margin-top:.85rem;display:flex;align-items:center;justify-content:space-between}
  .stars{color:var(--neon-yellow);font-size:.8rem;letter-spacing:1px}
  .card-author{font-size:.65rem;color:var(--muted);font-family:'Space Mono',monospace}
  .card-img-ph{width:100%;height:80px;background:linear-gradient(135deg,rgba(245,230,66,.08),rgba(255,61,139,.08));border:1px dashed rgba(255,255,255,.1);display:flex;align-items:center;justify-content:center;font-size:1.4rem;margin-bottom:.6rem}

  /* TICKER */
  .ticker-wrap{padding:2rem 0;overflow:hidden;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
  .ticker-label{text-align:center;font-family:'Space Mono',monospace;font-size:.65rem;color:var(--muted);letter-spacing:.15em;text-transform:uppercase;margin-bottom:1rem}
  .ticker-track{display:flex;gap:1.5rem;width:max-content;animation:ticker 25s linear infinite}
  @keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
  .ti{background:var(--surface);border:1px solid var(--border);padding:.5rem 1rem;white-space:nowrap;font-size:.8rem;display:flex;gap:.5rem;align-items:center}
  .ti-star{color:var(--neon-yellow)}
  .ti-name{color:var(--muted);font-size:.7rem;font-family:'Space Mono',monospace}

  /* FEED */
  .feed-section{padding:5rem 4rem}
  .section-label{font-family:'Space Mono',monospace;font-size:.68rem;color:var(--neon-cyan);letter-spacing:.15em;text-transform:uppercase;margin-bottom:.75rem}
  .section-label::before{content:'// '}
  .section-title{font-size:clamp(1.8rem,3vw,2.6rem);font-weight:800;letter-spacing:-.03em;margin-bottom:2rem}
  .cat-filter{display:flex;gap:.75rem;margin-bottom:2.5rem;flex-wrap:wrap}
  .cat-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:.45rem 1.1rem;font-family:'Familjen Grotesk',sans-serif;font-weight:700;font-size:.8rem;cursor:none;text-transform:uppercase;letter-spacing:.05em;transition:all .2s}
  .cat-btn:hover,.cat-btn.active{background:var(--neon-yellow);color:#0a0a0f;border-color:var(--neon-yellow)}
  .reviews-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem}
  .r-card{background:var(--surface);border:1px solid var(--border);padding:1.5rem;transition:border-color .2s,transform .2s;position:relative;overflow:hidden}
  .r-card::before{content:'';position:absolute;top:0;left:0;right:0;height:3px}
  .r-card.food::before{background:var(--neon-orange)}
  .r-card.spot::before{background:var(--neon-cyan)}
  .r-card.flat::before{background:var(--neon-pink)}
  .r-card.travel::before{background:var(--neon-yellow)}
  .r-card:hover{border-color:rgba(245,230,66,.3);transform:translateY(-3px)}
  .r-card img{width:100%;height:160px;object-fit:cover;margin-bottom:1rem}
  .r-card-title{font-weight:800;font-size:1rem;margin-bottom:.5rem}
  .r-card-body{font-size:.85rem;color:var(--muted);line-height:1.6;margin-bottom:1rem;display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
  .r-card-meta{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.5rem}
  .r-card-author{font-size:.7rem;color:var(--muted);font-family:'Space Mono',monospace}
  .r-card-location{font-size:.72rem;color:var(--muted);margin-top:.4rem}
  .r-card-location::before{content:'üìç '}
  .state-box{text-align:center;padding:4rem;color:var(--muted);font-family:'Space Mono',monospace;font-size:.85rem}
  .empty-state{text-align:center;padding:4rem;border:1px dashed var(--border);color:var(--muted);grid-column:1/-1}
  .empty-state .icon{font-size:3rem;margin-bottom:1rem}

  /* SQL PANEL */
  .sql-panel{background:var(--surface);border:1px solid rgba(245,230,66,.35);padding:1.5rem 2rem;margin:0 4rem 2rem}
  .sql-panel h3{color:var(--neon-yellow);font-size:.85rem;font-family:'Space Mono',monospace;margin-bottom:.75rem}
  .sql-panel pre{background:var(--bg);padding:1rem;font-size:.72rem;color:var(--neon-cyan);overflow-x:auto;line-height:1.6;font-family:'Space Mono',monospace}
  .sql-panel p{font-size:.8rem;color:var(--muted);margin-top:.75rem}

  /* MODALS */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(8px);z-index:800;display:none;align-items:center;justify-content:center;padding:1rem}
  .overlay.open{display:flex}
  .modal{background:var(--surface);border:1px solid var(--border);padding:2.5rem;width:100%;max-width:480px;position:relative;max-height:90vh;overflow-y:auto;animation:fadeUp .3s ease}
  .modal h2{font-size:1.5rem;font-weight:800;margin-bottom:.4rem}
  .modal-sub{color:var(--muted);font-size:.85rem;margin-bottom:2rem}
  .modal-close{position:absolute;top:1.25rem;right:1.25rem;background:none;border:none;color:var(--muted);font-size:1.3rem;cursor:none;transition:color .2s}
  .modal-close:hover{color:var(--neon-pink)}
  .modal-tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:1.75rem}
  .modal-tab{background:none;border:none;color:var(--muted);font-family:'Familjen Grotesk',sans-serif;font-weight:700;font-size:.9rem;padding:.75rem 1.25rem;cursor:none;border-bottom:2px solid transparent;transition:all .2s}
  .modal-tab.active{color:var(--neon-yellow);border-bottom-color:var(--neon-yellow)}
  .tab-panel{display:none}
  .tab-panel.active{display:block}
  .fg{margin-bottom:1.25rem}
  .fg label{display:block;font-size:.72rem;font-weight:700;text-transform:uppercase;letter-spacing:.07em;color:var(--muted);margin-bottom:.4rem}
  .fg input,.fg textarea,.fg select{width:100%;background:var(--bg);border:1px solid var(--border);color:var(--text);padding:.75rem 1rem;font-family:'Familjen Grotesk',sans-serif;font-size:.9rem;transition:border-color .2s;cursor:none}
  .fg input:focus,.fg textarea:focus,.fg select:focus{outline:none;border-color:var(--neon-yellow)}
  .fg textarea{resize:vertical;min-height:100px}
  .fg select option{background:var(--surface)}
  .star-rating{display:flex;gap:.5rem}
  .star-btn{background:none;border:none;font-size:1.5rem;cursor:none;color:var(--muted);transition:color .15s,transform .15s}
  .star-btn:hover,.star-btn.active{color:var(--neon-yellow);transform:scale(1.2)}
  .file-upload{border:2px dashed var(--border);padding:1.5rem;text-align:center;cursor:none;transition:border-color .2s}
  .file-upload:hover{border-color:var(--neon-yellow)}
  .file-upload p{color:var(--muted);font-size:.82rem;margin-top:.4rem}
  #imgPreview{width:100%;max-height:150px;object-fit:cover;margin-top:.75rem;display:none}
  .form-error{color:var(--neon-pink);font-size:.8rem;margin-top:.4rem;display:none}
  .form-success{color:#3ecf8e;font-size:.85rem;margin-top:.75rem;display:none}
  .submit-btn{width:100%;background:var(--neon-yellow);color:#0a0a0f;border:none;padding:1rem;font-family:'Familjen Grotesk',sans-serif;font-weight:800;font-size:1rem;text-transform:uppercase;letter-spacing:.05em;cursor:none;clip-path:polygon(0 0,calc(100% - 10px) 0,100% 10px,100% 100%,10px 100%,0 calc(100% - 10px));transition:all .2s;margin-top:1rem}
  .submit-btn:hover{background:var(--neon-pink);color:#fff}
  .submit-btn:disabled{opacity:.5;pointer-events:none}

  /* TOAST */
  .toast{position:fixed;bottom:2rem;right:2rem;background:var(--surface);border:1px solid var(--border);padding:1rem 1.5rem;z-index:9000;font-size:.85rem;transform:translateY(100px);opacity:0;transition:all .3s;max-width:300px}
  .toast.show{transform:translateY(0);opacity:1}
  .toast.success{border-left:3px solid #3ecf8e}
  .toast.error{border-left:3px solid var(--neon-pink)}

  footer{padding:2rem 4rem;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
  .footer-logo{font-family:'Permanent Marker',cursive;font-size:1.1rem;color:var(--neon-yellow)}
  .footer-copy{font-size:.72rem;color:var(--muted);font-family:'Space Mono',monospace}

  @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}

  @media(max-width:900px){
    nav{padding:1rem 1.25rem}
    .nav-links{display:none}
    .hero{grid-template-columns:1fr}
    .hero-right{display:none}
    .hero-left{padding:3.5rem 1.5rem}
    .feed-section{padding:3rem 1.5rem}
    .sql-panel{margin:0 1.5rem 1.5rem}
    footer{flex-direction:column;gap:1rem;text-align:center;padding:1.5rem}
  }
</style>
</head>
<body>

<div class="cursor" id="cursor"></div>
<div class="cursor-ring" id="cursorRing"></div>

<!-- NAV -->
<nav>
  <div class="logo">Random<span>Reviews</span></div>
  <ul class="nav-links">
    <li><a href="#" class="active" onclick="filterCat('all',this);return false">All</a></li>
    <li><a href="#" onclick="filterCat('food',this);return false">Food</a></li>
    <li><a href="#" onclick="filterCat('spot',this);return false">Spots</a></li>
    <li><a href="#" onclick="filterCat('flat',this);return false">Flats</a></li>
    <li><a href="#" onclick="filterCat('travel',this);return false">Travel</a></li>
  </ul>
  <div class="nav-right">
    <span id="userInfo"></span>
    <button class="nav-btn ghost" id="loginBtn" onclick="openAuth()">Login</button>
    <button class="nav-btn" id="reviewBtn" style="display:none" onclick="openReview()">+ Drop Review</button>
    <button class="nav-btn danger" id="logoutBtn" style="display:none" onclick="doLogout()">Logout</button>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-bg-grid"></div>
  <div class="hero-left">
    <div class="badge">SRM Students Only üî•</div>
    <h1>No BS.<br><span class="l2">Real Reviews.</span><br><span class="l3">By SRMites.</span></h1>
    <p class="hero-desc">Hidden biryani spots, overpriced hostels, sketchy flats, that chai place near the back gate ‚Äî <strong>everything your senior wouldn't tell you,</strong> now in one place.</p>
    <div class="hero-actions">
      <button class="btn-pri" onclick="document.getElementById('feedSection').scrollIntoView({behavior:'smooth'})">Start Exploring ‚Üí</button>
      <button class="btn-ghost-hero" onclick="openAuthOrReview()">Drop a Review</button>
    </div>
    <div class="hero-stats">
      <div><div class="stat-num" id="totalCount">‚Äî</div><div class="stat-label">Reviews</div></div>
      <div><div class="stat-num">4</div><div class="stat-label">Categories</div></div>
      <div><div class="stat-num" id="userCount">‚Äî</div><div class="stat-label">SRMites</div></div>
    </div>
  </div>
  <div class="hero-right">
    <div class="card-stack">
      <div class="review-card">
        <div class="card-img-ph">üçõ</div>
        <div class="card-tag tag-food">Food</div>
        <div class="card-title">Saravana Bhavan Near Gate 3</div>
        <div class="card-body">Bro the sambar rice at ‚Çπ45 hits different at 11pm. Always consistent, never disappoints.</div>
        <div class="card-footer"><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span><span class="card-author">@karthik_22cs</span></div>
      </div>
      <div class="review-card">
        <div class="card-tag tag-spot">Hidden Spot</div>
        <div class="card-title">Terrace Behind C Block</div>
        <div class="card-body">Best cram spot or just vibe zone. Zero crowd after 8pm. Bring a jacket tho.</div>
        <div class="card-footer"><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span><span class="card-author">@priya_mech21</span></div>
      </div>
      <div class="review-card">
        <div class="card-tag tag-flat">Flat / PG</div>
        <div class="card-title">Sai Residency, Potheri</div>
        <div class="card-body">AC room, ‚Çπ7500/mo. Owner is chill, no curfew, WiFi is actually fast.</div>
        <div class="card-footer"><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span><span class="card-author">@aditya_ece23</span></div>
      </div>
    </div>
  </div>
</section>

<!-- TICKER -->
<div class="ticker-wrap">
  <div class="ticker-label">Latest drops</div>
  <div class="ticker-track">
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> Mess Block D Breakfast <span class="ti-name">@riya_22bt</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span> Cheran Bus to Chennai <span class="ti-name">@sam_it23</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span> MK Flats near Guduvanchery <span class="ti-name">@vinoth_ee22</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> Shawarma Cart Gate 1 <span class="ti-name">@nisha_cse21</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</span> Hostel Curfew Bypass Route <span class="ti-name">@anon_srm</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> Library Bean Bags 6th Floor <span class="ti-name">@devansh_23</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span> Potheri Auto Stand Rates <span class="ti-name">@lakshmi_ece</span></div>
    <!-- duplicate for infinite scroll -->
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> Mess Block D Breakfast <span class="ti-name">@riya_22bt</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ</span> Cheran Bus to Chennai <span class="ti-name">@sam_it23</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span> MK Flats near Guduvanchery <span class="ti-name">@vinoth_ee22</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> Shawarma Cart Gate 1 <span class="ti-name">@nisha_cse21</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ</span> Hostel Curfew Bypass Route <span class="ti-name">@anon_srm</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span> Library Bean Bags 6th Floor <span class="ti-name">@devansh_23</span></div>
    <div class="ti"><span class="ti-star">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ</span> Potheri Auto Stand Rates <span class="ti-name">@lakshmi_ece</span></div>
  </div>
</div>

<!-- SQL SETUP HELPER -->
<div class="sql-panel" id="sqlHelper" style="display:none">
  <h3>‚ö†Ô∏è One-time DB setup needed ‚Äî go to Supabase ‚Üí SQL Editor ‚Üí paste and run this:</h3>
  <pre>create table if not exists reviews (
  id uuid default gen_random_uuid() primary key,
  created_at timestamp with time zone default now(),
  user_id uuid references auth.users(id) on delete cascade,
  username text,
  category text check (category in ('food','spot','flat','travel')),
  title text not null,
  body text not null,
  rating int check (rating between 1 and 5),
  location_name text,
  image_url text
);

alter table reviews enable row level security;

create policy "Public read" on reviews for select using (true);
create policy "Auth insert" on reviews for insert with check (auth.uid() = user_id);
create policy "Own delete" on reviews for delete using (auth.uid() = user_id);</pre>
  <p>After running, refresh this page. This panel disappears once the table is working.</p>
</div>

<!-- FEED -->
<section class="feed-section" id="feedSection">
  <div class="section-label">Browse reviews</div>
  <h2 class="section-title">What's everyone saying?</h2>
  <div class="cat-filter">
    <button class="cat-btn active" onclick="filterCat('all',this)">üî• All</button>
    <button class="cat-btn" onclick="filterCat('food',this)">üçú Food</button>
    <button class="cat-btn" onclick="filterCat('spot',this)">üó∫Ô∏è Spots</button>
    <button class="cat-btn" onclick="filterCat('flat',this)">üè† Flats</button>
    <button class="cat-btn" onclick="filterCat('travel',this)">üöå Travel</button>
  </div>
  <div id="reviewsGrid" class="reviews-grid">
    <div class="state-box">Loading reviews...</div>
  </div>
</section>

<footer>
  <div class="footer-logo">RandomReviews</div>
  <div class="footer-copy">// built for SRMites, by SRMites ¬∑ 2025</div>
</footer>

<!-- AUTH MODAL -->
<div class="overlay" id="authModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('authModal')">‚úï</button>
    <h2>Welcome üëã</h2>
    <p class="modal-sub">Use your SRM email to sign up or log in.</p>
    <div class="modal-tabs">
      <button class="modal-tab active" id="tabLogin" onclick="switchTab('login')">Login</button>
      <button class="modal-tab" id="tabSignup" onclick="switchTab('signup')">Sign Up</button>
    </div>
    <!-- LOGIN -->
    <div class="tab-panel active" id="loginPanel">
      <div class="fg"><label>Email</label><input type="email" id="loginEmail" placeholder="you@srmist.edu.in"></div>
      <div class="fg"><label>Password</label><input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <div class="form-error" id="loginError"></div>
      <button class="submit-btn" id="loginBtn2" onclick="doLogin()">Login ‚Üí</button>
    </div>
    <!-- SIGNUP -->
    <div class="tab-panel" id="signupPanel">
      <div class="fg"><label>SRM Email</label><input type="email" id="signupEmail" placeholder="ra1234@srmist.edu.in"></div>
      <div class="fg"><label>Password (min 6 chars)</label><input type="password" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"></div>
      <div class="fg"><label>Display Name / Username</label><input type="text" id="signupUsername" placeholder="karthik_22cs"></div>
      <div class="form-error" id="signupError"></div>
      <div class="form-success" id="signupSuccess">‚úÖ Check your email to confirm, then log in!</div>
      <button class="submit-btn" id="signupBtn2" onclick="doSignup()">Create Account ‚Üí</button>
    </div>
  </div>
</div>

<!-- REVIEW MODAL -->
<div class="overlay" id="reviewModal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('reviewModal')">‚úï</button>
    <h2>Drop a Review üî•</h2>
    <p class="modal-sub">Be real. Other SRMites are counting on you.</p>
    <div class="fg">
      <label>Category</label>
      <select id="rCategory">
        <option value="food">üçú Food & Drinks</option>
        <option value="spot">üó∫Ô∏è Hidden Spot</option>
        <option value="flat">üè† Flat / PG</option>
        <option value="travel">üöå Travel & Transit</option>
      </select>
    </div>
    <div class="fg"><label>Title</label><input type="text" id="rTitle" placeholder="e.g. Shawarma cart near Gate 1"></div>
    <div class="fg"><label>Location (optional)</label><input type="text" id="rLocation" placeholder="e.g. Near Gate 3, Potheri"></div>
    <div class="fg"><label>Your Review</label><textarea id="rBody" placeholder="Be honest. What did you actually think? Is it worth it?"></textarea></div>
    <div class="fg">
      <label>Rating</label>
      <div class="star-rating">
        <button class="star-btn" onclick="setRating(1)">‚òÖ</button>
        <button class="star-btn" onclick="setRating(2)">‚òÖ</button>
        <button class="star-btn" onclick="setRating(3)">‚òÖ</button>
        <button class="star-btn" onclick="setRating(4)">‚òÖ</button>
        <button class="star-btn" onclick="setRating(5)">‚òÖ</button>
      </div>
    </div>
    <div class="fg">
      <label>Photo (optional)</label>
      <div class="file-upload" onclick="document.getElementById('photoInput').click()">
        <p>üì∑ Click to upload a photo</p>
        <p>JPG, PNG ‚Äî max 5MB</p>
        <input type="file" id="photoInput" accept="image/*" style="display:none" onchange="previewImg(this)">
        <img id="imgPreview" alt="preview">
      </div>
    </div>
    <div class="form-error" id="reviewError"></div>
    <button class="submit-btn" id="submitBtn" onclick="submitReview()">Post Review ‚Üí</button>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const { createClient } = supabase
const db = createClient(
  'https://crczujkkyaxgxcdlgqxh.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyY3p1amtreWF4Z3hjZGxncXhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1ODIzNDcsImV4cCI6MjA4NzE1ODM0N30.ytuBOH34PUvkT2XXD_Ky4TTuQZIIibNVyVInUvFTO4Y'
)

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let currentUser = null
let currentRating = 0
let currentFilter = 'all'
let allReviews = []

// ‚îÄ‚îÄ CURSOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const curEl = document.getElementById('cursor')
const ringEl = document.getElementById('cursorRing')
let mx=0,my=0,rx=0,ry=0
document.addEventListener('mousemove',e=>{mx=e.clientX;my=e.clientY;curEl.style.transform=`translate(${mx-6}px,${my-6}px)`})
;(function loop(){rx+=(mx-rx-18)*.12;ry+=(my-ry-18)*.12;ringEl.style.transform=`translate(${rx}px,${ry}px)`;requestAnimationFrame(loop)})()
document.addEventListener('mouseover',e=>{if(e.target.closest('button,a,.r-card,.cat-btn')){ringEl.style.width='56px';ringEl.style.height='56px'}else{ringEl.style.width='36px';ringEl.style.height='36px'}})

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function initAuth(){
  const {data:{session}} = await db.auth.getSession()
  if(session?.user) setUser(session.user)
  db.auth.onAuthStateChange((_,session)=>{
    if(session?.user) setUser(session.user)
    else clearUser()
  })
}

function setUser(u){
  currentUser=u
  const name=u.user_metadata?.username||u.email.split('@')[0]
  document.getElementById('userInfo').textContent='@'+name
  document.getElementById('loginBtn').style.display='none'
  document.getElementById('reviewBtn').style.display='inline-block'
  document.getElementById('logoutBtn').style.display='inline-block'
  closeModal('authModal')
}
function clearUser(){
  currentUser=null
  document.getElementById('userInfo').textContent=''
  document.getElementById('loginBtn').style.display='inline-block'
  document.getElementById('reviewBtn').style.display='none'
  document.getElementById('logoutBtn').style.display='none'
}

async function doLogin(){
  const email=document.getElementById('loginEmail').value.trim()
  const pass=document.getElementById('loginPassword').value
  const errEl=document.getElementById('loginError')
  const btn=document.getElementById('loginBtn2')
  errEl.style.display='none'
  if(!email||!pass){showErr(errEl,'Fill in all fields');return}
  btn.disabled=true;btn.textContent='Logging in...'
  const {error}=await db.auth.signInWithPassword({email,password:pass})
  btn.disabled=false;btn.textContent='Login ‚Üí'
  if(error) showErr(errEl,error.message)
  else showToast('Logged in! Welcome back üî•','success')
}

async function doSignup(){
  const email=document.getElementById('signupEmail').value.trim()
  const pass=document.getElementById('signupPassword').value
  const username=document.getElementById('signupUsername').value.trim()
  const errEl=document.getElementById('signupError')
  const sucEl=document.getElementById('signupSuccess')
  const btn=document.getElementById('signupBtn2')
  errEl.style.display='none';sucEl.style.display='none'
  if(!email||!pass||!username){showErr(errEl,'Fill in all fields');return}
  if(pass.length<6){showErr(errEl,'Password needs at least 6 characters');return}
  btn.disabled=true;btn.textContent='Creating account...'
  const {error}=await db.auth.signUp({email,password:pass,options:{data:{username:username.replace('@','')}}})
  btn.disabled=false;btn.textContent='Create Account ‚Üí'
  if(error) showErr(errEl,error.message)
  else{sucEl.style.display='block';showToast('Check your email to confirm! üì¨','success')}
}

async function doLogout(){
  await db.auth.signOut()
  showToast('Logged out. See you! üëã','success')
}

// ‚îÄ‚îÄ REVIEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadReviews(){
  document.getElementById('reviewsGrid').innerHTML='<div class="state-box">Loading reviews...</div>'
  try{
    const {data,error}=await db.from('reviews').select('*').order('created_at',{ascending:false})
    if(error) throw error
    document.getElementById('sqlHelper').style.display='none'
    allReviews=data||[]
    renderReviews()
    document.getElementById('totalCount').textContent=allReviews.length+'+'
    document.getElementById('userCount').textContent=Math.max(1,Math.floor(allReviews.length*1.4))+'+'
  }catch(e){
    console.error(e)
    document.getElementById('reviewsGrid').innerHTML='<div class="state-box">‚ö†Ô∏è Could not load reviews. See setup instructions above.</div>'
    document.getElementById('sqlHelper').style.display='block'
    document.getElementById('totalCount').textContent='0'
    document.getElementById('userCount').textContent='0'
  }
}

function renderReviews(){
  const grid=document.getElementById('reviewsGrid')
  const list=currentFilter==='all'?allReviews:allReviews.filter(r=>r.category===currentFilter)
  if(!list.length){
    grid.innerHTML=`<div class="empty-state"><div class="icon">ü´•</div><p>No reviews here yet.<br>Be the first to drop one!</p></div>`
    return
  }
  const tagMap={food:'tag-food',spot:'tag-spot',flat:'tag-flat',travel:'tag-travel'}
  const catLabel={food:'üçú Food',spot:'üó∫Ô∏è Spot',flat:'üè† Flat',travel:'üöå Travel'}
  grid.innerHTML=list.map(r=>{
    const stars='‚òÖ'.repeat(r.rating)+'‚òÜ'.repeat(5-r.rating)
    const img=r.image_url?`<img src="${r.image_url}" alt="photo" loading="lazy">`:'';
    const loc=r.location_name?`<div class="r-card-location">${esc(r.location_name)}</div>`:''
    const date=new Date(r.created_at).toLocaleDateString('en-IN',{day:'numeric',month:'short'})
    const uname=r.username||'anon'
    return `<div class="r-card ${r.category}">${img}<div class="card-tag ${tagMap[r.category]}">${catLabel[r.category]}</div><div class="r-card-title">${esc(r.title)}</div><div class="r-card-body">${esc(r.body)}</div>${loc}<div class="r-card-meta"><span class="stars">${stars}</span><span class="r-card-author">@${esc(uname)} ¬∑ ${date}</span></div></div>`
  }).join('')
}

async function submitReview(){
  if(!currentUser){openAuth();return}
  const title=document.getElementById('rTitle').value.trim()
  const body=document.getElementById('rBody').value.trim()
  const category=document.getElementById('rCategory').value
  const location=document.getElementById('rLocation').value.trim()
  const errEl=document.getElementById('reviewError')
  const btn=document.getElementById('submitBtn')
  errEl.style.display='none'
  if(!title){showErr(errEl,'Give your review a title');return}
  if(!body){showErr(errEl,'Write something in the review');return}
  if(!currentRating){showErr(errEl,'Pick a star rating');return}
  btn.disabled=true;btn.textContent='Posting...'

  // Upload photo if present
  let imageUrl=null
  const file=document.getElementById('photoInput').files[0]
  if(file){
    const ext=file.name.split('.').pop()
    const fname=`${Date.now()}-${Math.random().toString(36).slice(2)}.${ext}`
    const {error:upErr}=await db.storage.from('review-images').upload(fname,file)
    if(upErr){showErr(errEl,'Photo upload failed: '+upErr.message);btn.disabled=false;btn.textContent='Post Review ‚Üí';return}
    const {data:{publicUrl}}=db.storage.from('review-images').getPublicUrl(fname)
    imageUrl=publicUrl
  }

  const uname=currentUser.user_metadata?.username||currentUser.email.split('@')[0]
  const {error}=await db.from('reviews').insert({
    user_id:currentUser.id, username:uname,
    title, body, category, rating:currentRating,
    location_name:location||null, image_url:imageUrl
  })
  btn.disabled=false;btn.textContent='Post Review ‚Üí'
  if(error){
    showErr(errEl,error.message.includes('policy')||error.message.includes('permission')?'DB not set up yet ‚Äî run the SQL setup from the panel above first.':error.message)
  } else {
    showToast('Review posted! üî• Keeping it real.','success')
    closeModal('reviewModal')
    resetForm()
    loadReviews()
  }
}

// ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function filterCat(cat,el){
  currentFilter=cat
  document.querySelectorAll('.cat-btn,.nav-links a').forEach(b=>b.classList.remove('active'))
  if(el) el.classList.add('active')
  renderReviews()
}
function setRating(val){
  currentRating=val
  document.querySelectorAll('.star-btn').forEach((b,i)=>b.classList.toggle('active',i<val))
}
function previewImg(input){
  const prev=document.getElementById('imgPreview')
  if(input.files&&input.files[0]){
    const reader=new FileReader()
    reader.onload=e=>{prev.src=e.target.result;prev.style.display='block'}
    reader.readAsDataURL(input.files[0])
  }
}
function openAuth(){document.getElementById('authModal').classList.add('open')}
function openReview(){document.getElementById('reviewModal').classList.add('open')}
function closeModal(id){document.getElementById(id).classList.remove('open')}
function openAuthOrReview(){currentUser?openReview():openAuth()}
function switchTab(tab){
  document.getElementById('tabLogin').classList.toggle('active',tab==='login')
  document.getElementById('tabSignup').classList.toggle('active',tab==='signup')
  document.getElementById('loginPanel').classList.toggle('active',tab==='login')
  document.getElementById('signupPanel').classList.toggle('active',tab==='signup')
}
function resetForm(){
  document.getElementById('rTitle').value=''
  document.getElementById('rBody').value=''
  document.getElementById('rLocation').value=''
  document.getElementById('photoInput').value=''
  document.getElementById('imgPreview').style.display='none'
  currentRating=0
  document.querySelectorAll('.star-btn').forEach(b=>b.classList.remove('active'))
}
function showToast(msg,type){
  const t=document.getElementById('toast')
  t.textContent=msg;t.className=`toast ${type} show`
  setTimeout(()=>t.classList.remove('show'),3500)
}
function showErr(el,msg){el.textContent=msg;el.style.display='block'}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}

// close modals on bg click
document.querySelectorAll('.overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open')}))

// ‚îÄ‚îÄ BOOT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
initAuth()
loadReviews()
</script>
</body>
</html>
